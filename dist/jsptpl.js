/*
 *  _           _         _ 
   (_)         | |       | |
    _ ___ _ __ | |_ _ __ | |
   | / __| '_ \| __| '_ \| |
   | \__ \ |_) | |_| |_) | |
   | |___/ .__/ \__| .__/|_|
  _/ |   | |       | |      
 |__/    |_|       |_|      

 * 
 *jsptl.js  基于jsp jstl语法的模版引擎
 *@author gonghongyu <gonghongyu@le.com>
 *@version 0.0.1
 * **/;
!function(){var n=function(n,t){var e=[],r=0,i=function(){};i.prototype={c:"",po:0,pnode:null,findEnd:function(n){var s=n.indexOf("<"+t),p=n.indexOf("</"+t),o=n.indexOf("<"+t,n.indexOf("<"+t)+1),h=n.indexOf("</"+t,n.indexOf("</"+t)+1),a=new i;if(s>=0&&p>s){if(null!=this.pnode&&s>0){var f=n.substring(0,s);this.pnode.append(f)}if(o>0&&p>o){var l=n.substring(s,o),u=n.substring(o);a.pnode=this,a.po=this.po+1,this.s=r+s,r+=o,this.append(l),a.findEnd(u)}else{var l=n.substring(s,p+t.length+3),u=n.substring(p+t.length+3);this.s=r+s,r+=p+t.length+3,this.e=r,this.append(l),null!=this.pnode&&(a.pnode=this.pnode,a.po=this.po);var g={p:this.po,c:this.c,s:this.s,e:this.e};e.push(g),a.findEnd(u)}}else if(p>=0&&0>s||s>p){var l=n.substring(0,p+t.length+3),u=n.substring(p+t.length+3);r+=p+t.length+3,this.append(l),this.pnode.e=r;var g={p:this.pnode.po,c:this.pnode.c,e:this.pnode.e,s:this.pnode.s};e.push(g),h>0&&(s>h||0>s)?null!=this.pnode&&this.pnode.findEnd(u):s>0&&(0>h||h>s)&&null!=this.pnode&&(a.pnode=this.pnode.pnode,a.po=this.pnode.po,this.pnode=a,a.findEnd(u))}return""},append:function(n){this.c=this.c+n,null!=this.pnode&&this.pnode.append(n)}};var s=new i;s.findEnd(n);for(var p=0;p<e.length;p++);return e},t=function(n){function t(n,s,p){var o=e(n,s,p);if(r.push(n[o]),o>s&&i.push(o),o>s)t(n,s,o);else{for(1>=p-s?(s=i[i.length-1]+1,i.pop(),p=i[i.length-1]):s+=1;s>=p;)s=p+1,i.pop(),p=i[i.length-1];0!=i.length&&t(n,s,p)}}function e(n,t,e){if(null==n[t])return 0;for(var r=n[t].p,i=t,s=t;e>s;s++)n[s].p<r&&(r=n[s].p,i=s);return i}if(null==n||0==n.length)return[];var r=[],i=[];return i.push(n.length),t(n,0,n.length),r};String.prototype.tagsearcha=function(e,r){var i=n(this,e)||[],s=t(i)||[];if("function"==typeof r)for(var p=0;p<s.length;p++){r(s[p].c,s[p].s,s[p].l)}},String.prototype.tagsearchTop=function(e,r){var i=new n(this.toString(),e)||[],s=new t(i)||[],p=this;if("function"==typeof r){var o="",h="",a=0;if(s.length>0){for(var f=0;f<s.length;f++)if(s[f]&&0==s[f].p){var l=this.substring(a,s[f].s);h=this.substring(s[f].e),a=s[f].e;var u=r(s[f].c,s[f].s,s[f].e,s[f].p)||"";o+=l+u}p=o+h}else p=this.toString()}return p}}(),function(){function jsptpl(n){this.jsptpl=n}function get_value(n,t){for(var e=t.split(".");e.length;){if(null==n)return!1;if(!(e[0]in n))return!1;n=n[e.shift()]}return n}function render(fragment,vars){var tagret=fragment.tagsearchTop("c:forEach",function(n){var t=n.replace(taglib_each_reg,function(n,t,e,r){var i,s=get_value(vars,t),p="";for(i in s)if(s.hasOwnProperty(i)){var o={};o[e]=s[i],p+=render(r,o)}return p});return t});return tagret.replace(taglib_if_reg,function(allstr,_,express,inner){try{eval()}catch(e){}return""}).replace(taglib_jsp_reg,function(n,t){var e=get_value(vars,t);return e||0===e?e:""})}var taglib_jsp_reg=/\$\{(.+?)\}/g,taglib_each_reg=/<[c|t]:forEach[\s]*items=["|']\$\{(.+?)\}.*[\s]+?var=["|'](.+?)["|'].*>([\s\S]*)<\/[c|t]:forEach>/g,taglib_if_reg=/<[c|t]:if\s+test=\s*(["|'])\$\{(.+?=?.+)\}\1+?>([\s\S]+?)<\/[c|t]:if>/g;jsptpl.prototype.render=function(n){return render(this.jsptpl,n)},window.jsptpl=jsptpl}();;