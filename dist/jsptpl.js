/*
 *  _           _         _ 
   (_)         | |       | |
    _ ___ _ __ | |_ _ __ | |
   | / __| '_ \| __| '_ \| |
   | \__ \ |_) | |_| |_) | |
   | |___/ .__/ \__| .__/|_|
  _/ |   | |       | |      
 |__/    |_|       |_|      

 * 
 *jsptl.js  基于jsp jstl语法的模版引擎
 *@author gonghongyu <gonghongyu@le.com>
 *@version 0.0.1
 * **/;
!function(){var e=function(e,r){var t=[],n=0,a=function(){};a.prototype={c:"",po:0,pnode:null,findEnd:function(e){var s=e.indexOf("<"+r),i=e.indexOf("</"+r),p=e.indexOf("<"+r,e.indexOf("<"+r)+1),o=e.indexOf("</"+r,e.indexOf("</"+r)+1),h=new a;if(s>=0&&i>s){if(null!=this.pnode&&s>0){var l=e.substring(0,s);this.pnode.append(l)}if(p>0&&i>p){var u=e.substring(s,p),f=e.substring(p);h.pnode=this,h.po=this.po+1,this.s=n+s,n+=p,this.append(u),h.findEnd(f)}else{var u=e.substring(s,i+r.length+3),f=e.substring(i+r.length+3);this.s=n+s,n+=i+r.length+3,this.e=n,this.append(u),null!=this.pnode&&(h.pnode=this.pnode,h.po=this.po);var g={p:this.po,c:this.c,s:this.s,e:this.e};t.push(g),h.findEnd(f)}}else if(i>=0&&0>s||s>i){var u=e.substring(0,i+r.length+3),f=e.substring(i+r.length+3);n+=i+r.length+3,this.append(u),this.pnode.e=n;var g={p:this.pnode.po,c:this.pnode.c,e:this.pnode.e,s:this.pnode.s};t.push(g),o>0&&(s>o||0>s)?null!=this.pnode&&this.pnode.findEnd(f):s>0&&(0>o||o>s)&&null!=this.pnode&&(h.pnode=this.pnode.pnode,h.po=this.pnode.po,this.pnode=h,h.findEnd(f))}return""},append:function(e){this.c=this.c+e,null!=this.pnode&&this.pnode.append(e)}};var s=new a;s.findEnd(e);for(var i=0;i<t.length;i++);return t},r=function(e){function r(e,s,i){var p=t(e,s,i);if(n.push(e[p]),p>s&&a.push(p),p>s)r(e,s,p);else{for(1>=i-s?(s=a[a.length-1]+1,a.pop(),i=a[a.length-1]):s+=1;s>=i;)s=i+1,a.pop(),i=a[a.length-1];0!=a.length&&r(e,s,i)}}function t(e,r,t){if(null==e[r])return 0;for(var n=e[r].p,a=r,s=r;t>s;s++)e[s].p<n&&(n=e[s].p,a=s);return a}if(null==e||0==e.length)return[];var n=[],a=[];return a.push(e.length),r(e,0,e.length),n};String.prototype.tagsearcha=function(t,n){var a=e(this,t)||[],s=r(a)||[];if("function"==typeof n)for(var i=0;i<s.length;i++){n(s[i].c,s[i].s,s[i].l)}},String.prototype.tagsearchTop=function(t,n){var a=new e(this.toString(),t)||[],s=new r(a)||[],i=this;if("function"==typeof n){var p="",o="",h=0;if(s.length>0){for(var l=0;l<s.length;l++)if(s[l]&&0==s[l].p){var u=this.substring(h,s[l].s);o=this.substring(s[l].e),h=s[l].e;var f=n(s[l].c,s[l].s,s[l].e,s[l].p)||"";p+=u+f}i=p+o}else i=this.toString()}return i}}(),function(){function jsptpl(e){this.jsptpl=e}function get_value(e,r){for(var t=r.split(".");t.length;){if(null==e)return!1;if(!(t[0]in e))return!1;e=e[t.shift()]}return e}function getExpress_value(vars,express){var spreg=/(.*?)(==|>=|<=|>|<)(.*)/g,reg=/^[\d]+$|(?=(['"]).*?\1|true|false)/g,array=[],cond;express.replace(spreg,function(e,r,t,n){array.push(r),array.push(n),cond=t});var ret=!1;if(array.length>1){if(array[0]=reg.test(array[0])?array[0].replace(/['"]/g,""):get_value(vars,array[0]),array[1]=reg.test(array[1])?array[1].replace(/['"]/g,""):get_value(vars,array[1]),null!=cond)try{ret="=="==cond?array[0]==array[1]:eval("("+array[0]+cond+array[1]+")")}catch(e){ret=!1}}else ret=get_value(vars,express);return ret}function render(fragment,vars){var tagret=fragment.tagsearchTop("c:forEach",function(e){var r=e.replace(taglib_each_reg,function(e,r,t,n){var a,s=get_value(vars,r),i="";for(a in s)if(s.hasOwnProperty(a)){var p={};p[t]=s[a],i+=render(n,p)}return i});return r});return tagret.replace(taglib_if_reg,function(allstr,_,express,inner){for(var check=!1,a1=express.split("&&"),i=0;i<a1.length;i++){var item=a1[i],a2=item.split("||");if(a2.length>1){for(var j=0;j<a2.length;j++)a2[j]=getExpress_value(vars,a2[j]);a1[i]=a2.join("||")}else a1[i]=getExpress_value(vars,a2[0])}var ret_express=a1.join("&&");try{check=eval("("+ret_express+")")}catch(e){check=!1}return check?render(inner,vars):""}).replace(taglib_jsp_reg,function(e,r){var t=get_value(vars,r);return t||0===t?t:""})}var taglib_jsp_reg=/\$\{(.+?)\}/g,taglib_each_reg=/<[c|t]:forEach[\s]*items=["|']\$\{(.+?)\}.*?[\s]+?var=["|'](.+?)["|'].*?>([\s\S]*)<\/[c|t]:forEach>/g,taglib_if_reg=/<[c|t]:if\s+test=\s*(["|'])\$\{(.+?=?.+)\}\1+?>([\s\S]+?)<\/[c|t]:if>/g;jsptpl.prototype.render=function(e){return render(this.jsptpl,e)},window.jsptpl=jsptpl}(),window.TPL=function(){var e={tplmap:{},getTmp:function(e){return this.tplmap[e]}};return e}();;